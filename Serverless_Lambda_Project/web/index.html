<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
        <!-- Required meta tags -->
        <link rel="stylesheet" href="css/style.css" />

        <title>Online Form</title>
    </head>
    <body>
        <div class="section_book">
            <h2 class="heading_h1">LANDING ZONE DETAILS</h2>
            <small id="emailHelp" class="form_text text_muted">
                * All field is <b>REQUIRED</b> to complete
            </small>
            <br/><br/>
            <form
                action=""
                method="POST"
                class="form_inline"
                name="contact_form"
            >
                <input
                    type="email"
                    class="form_input"
                    placeholder="Email Address"
                    id="email"
                    name="email"
                    required
                />
                <label for="email" class="form_label">Email Address</label>
                <small id="emailHelp" class="form_text text_muted">
                    We'll never share your email with anyone else.
                </small>
                <br/><br/>

                <input
                    type="text"
                    class="form_input"
                    placeholder="Company Name"
                    id="customername"
                    name="customername"
                    required pattern="^[a-z0-9-]*$"
                />
                <label for="name" class="form_label">Company Name</label>
                <small id="emailHelp" class="form_text text_muted">
                    Only small letters, numbers and hyphen allowed (no spaces)
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="Shared Service Account"
                    id="accountnumber"
                    name="accountnumber"
                    required pattern="^[0-9]{12}$"
                />
                <label for="accountnumber" class="form_label">Shared Service Account</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter Shared Services 12-digit AWS Account Number
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="External ID"
                    id="ext_id"
                    name="ext_id"
                    required
                />
                <label for="ext_id" class="form_label">External ID</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter External ID
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="CIDR"
                    id="cidr"
                    name="cidr"
                    required pattern="^(([0-9]){1,3}\.){3}[0-9]{1,3}\/[1-2][0-8]$"
                />
                <label for="cidr" class="form_label">CIDR</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter VPC CIDR. e.g. 10.0.0.0/16
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="Whitelist CIDR"
                    id="whitelist"
                    name="whitelist"
                    required pattern="^((([0-9]){1,3}\.){3}[0-9]{1,3}\/([0-9],|[1-2][0-8],)|(([0-9]){1,3}\.){3}[0-9]{1,3}\/([0-9]|[1-2][0-8])){1,}$"
                />
                <label for="whitelist" class="form_label">Whitelist CIDR</label>
                <small id="emailHelp" class="form_text text_muted">
                    If multiple CIDRs, separate them by commas (no spaces allowed) e.g. 10.0.0.0/8,10.0.0.0/9,192.10.8.0/16
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="VPC Region"
                    id="region"
                    name="region"
                    required pattern="^(us|eu|ap|ca|me|sa)-[a-z]*-[1-3]{1}$"
                />
                <label for="region" class="form_label">VPC Region</label>
                <small id="emailHelp" class="form_text text_muted">
                    Only small letters and hyphen allowed e.g. us-east-1
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="VPC Name"
                    id="vpcname"
                    name="vpcname"
                    required
                />
                <label for="vpcname" class="form_label">VPC Name</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter VPC Name
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="Environment"
                    id="env"
                    name="env"
                    required pattern="^[a-z0-9_-]*$"
                />
                <label for="env" class="form_label">Environment</label>
                <small id="emailHelp" class="form_text text_muted">
                    Eg dev, prod. Only a-z0-9_- allowed
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="Customer Gateway IP"
                    id="cgwip"
                    name="cgwip"
                    required pattern="^(([0-9]){1,3}\.){3}[0-9]{1,3}$"
                />
                <label for="cgwip" class="form_label">Customer Gateway IP</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter IP address (not cidr)
                </small>
                <br/><br/>
                
                <input
                    type="text"
                    class="form_input"
                    placeholder="AFT Account"
                    id="aftacct"
                    name="aftacct"
                    required pattern="^[0-9]{12}$"
                />
                <label for="aftacct" class="form_label">AFT Account</label>
                <small id="emailHelp" class="form_text text_muted">
                    Enter 12-digit AFT AWS Account Number
                </small>
                <div class="send">
                    <button type="submit" class="btn btn--blue" name="submit">
                        SUBMIT &rarr;
                    </button>
                </div>
            </form>
        </div>

        <!--Form handling submission asynchronously using XMLHttpRequest-->
        <script>
            (() => {
                //Form and URL Configuration - The <Form> element in the document and en element with the ID 'response'.
                const form = document.querySelector('form');
                const submitResponse = document.querySelector('#response');
                //The variable formURL contains the URL where the form data will be submitted
                const formURL = 'API GATEWAY INVOKE URL ENDING IN /FORM';
            
                // Form Submission Handling -  The forms onsubmit event prevents the default form submission behaviour
                form.onsubmit = e => {
                    e.preventDefault();
                    
                    /* Data Collection - It collects the data by iterating over form inputs and creating a JavaScript object
                    'data' with input IDs as keys and input values as values */
                    let data = {};
                    Array.from(form).map(input => (data[input.id] = input.value));
                    console.log('Sending: ', JSON.stringify(data));
                    submitResponse.innerHTML = 'Sending...'
        
                    /* AJAX Request Configuration - Creates an XMLHttpRequest object, sets the request method (GET/POST) based on 
                    the form's method */
                    var xhr = new XMLHttpRequest();
                    xhr.open(form.method, formURL, true);
                    xhr.setRequestHeader('Accept', 'application/json; charset=utf-8');
                    xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        
                    // Data Submission - It sends the collected form data as a JSON string in the request body
                    xhr.send(JSON.stringify(data));
                    
                    /* Handling Response - If the status is 200 (OK), it resets and desplay a success message. Otherwise, it 
                    logs an error to the console */
                    xhr.onloadend = response => {
                    if (response.target.status === 200) {
                        form.reset();
                        submitResponse.innerHTML = 'Form submitted. Success!';
                    } else {
                        submitResponse.innerHTML = 'Form submission failed!';
                        console.error(JSON.parse(response));
                    }
                    };    
                };
            })();
        </script>
    </body>
</html>